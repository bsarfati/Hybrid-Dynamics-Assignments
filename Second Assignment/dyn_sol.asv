function [q_dd]=dyn_sol(q,q_d,t,tau)

% b = 1:3;
% s = 4:5;

% qs = q(s); redundancy in angles_input:
% qs_d = q_d(s); 1: we don't need qs and qs_d; 2: we can get them from this
% [~,~,qs_dd]=angles_input(t);
[M,B,W,Fd]=dynamics_mat(q,q_d);
Fq = [0;0;0;
% Mbb = M(b,b);
% Mbs = M(b,s);
% Mss = M(s,s);
% Bb = B(b);
% Bs = B(s);
% Gb = G(b);
% Gs = G(s);


qb_dd = [M -W'; W zeros(2,2)]\(Fq-Fd-B*q);
tau = Mbs'*qb_dd+Mss*qs_dd+Bs+Gs;